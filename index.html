<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>í¬ë¡œë§ˆ ì‹œí”„íŠ¸ (Chroma Shift)</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            background-color: #000; /* ê²€ì€ìƒ‰ ë°°ê²½ */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            touch-action: none; /* ëª¨ë°”ì¼ ìŠ¤í¬ë¡¤/ì¤Œ ë°©ì§€ */
        }

        #game-canvas {
            background-color: #0a0a0a;
            border: 2px solid #333;
            cursor: none; /* ë§ˆìš°ìŠ¤ ì»¤ì„œ ìˆ¨ê¹€ */
        }

        /* --- ì‹œì‘/ì¢…ë£Œ ì˜¤ë²„ë ˆì´ --- */
        #game-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            max-width: 500px;
            max-height: 700px;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            transition: opacity 0.5s ease, visibility 0.5s;
            visibility: visible;
            opacity: 1;
            z-index: 10;
        }

        #game-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #game-overlay h1 {
            color: #FFF;
            text-shadow: 0 0 10px #0FF, 0 0 20px #F0F;
            margin-bottom: 10px;
        }

        #game-overlay p {
            font-size: 1.1em;
            margin: 10px 20px;
            line-height: 1.5;
        }
        
        #controls-info {
            font-size: 0.9em;
            color: #aaa;
        }

        #start-button {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            color: #000;
            background-color: #FFF;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 0 20px #FFF;
            margin-top: 20px;
            transition: transform 0.1s ease;
        }
        
        #start-button:active {
            transform: scale(0.95);
        }

        #final-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #FFF;
            margin: 10px 0;
        }

    </style>
</head>
<body>

    <canvas id="game-canvas"></canvas>

    <div id="game-overlay" data-mode="start">
        <h1>ğŸ’  í¬ë¡œë§ˆ ì‹œí”„íŠ¸ ğŸ’ </h1>
        <p>
            ìì‹ ê³¼ <b style="color: #00FFFF;">ê°™ì€ ìƒ‰ì˜ ë¹›(ë²½)</b>ë§Œ í†µê³¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            ì¹˜ëª…ì ì¸ <b style="color: #FF0033;">ë¶‰ì€ìƒ‰ ìŠ¤íŒŒì´í¬(ğŸ”º)</b>ë¥¼ í”¼í•˜ì„¸ìš”!
        </p>
        <p id="controls-info">
            <b>[PC]</b> Space(ê¾¹ ëˆ„ë¥´ê¸°): ìƒìŠ¹ / í´ë¦­: ìƒ‰ìƒ ë³€ê²½<br>
            <b>[ëª¨ë°”ì¼]</b> ì™¼ìª½(ê¾¹ ëˆ„ë¥´ê¸°): ìƒìŠ¹ / ì˜¤ë¥¸ìª½(íƒ­): ìƒ‰ìƒ ë³€ê²½
        </p>
        <p id="final-score"></p>
        <button id="start-button">ì‹œì‘í•˜ê¸°</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- DOM ìš”ì†Œ ---
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const gameOverlay = document.getElementById('game-overlay');
            const startButton = document.getElementById('start-button');
            const finalScoreDisplay = document.getElementById('final-score');

            // --- ìº”ë²„ìŠ¤ í¬ê¸° ì„¤ì • ---
            const VIEWPORT_WIDTH = Math.min(window.innerWidth, 500);
            const VIEWPORT_HEIGHT = Math.min(window.innerHeight, 700);
            
            canvas.width = VIEWPORT_WIDTH;
            canvas.height = VIEWPORT_HEIGHT;

            // --- ê²Œì„ ìƒíƒœ ë° ì„¤ì • ---
            let gameState = 'start'; // 'start', 'playing', 'over'
            let score = 0;
            let gameLoopId = null;
            let obstacles = [];
            let frameCount = 0;
            
            const PLAYER_SIZE = 15;
            const GRAVITY = 0.18;
            const LIFT_FORCE = -0.3;
            let SCROLL_SPEED = 3;
            
            const COLORS = {
                BLUE: '#00FFFF', // ì‹œì•ˆ
                YELLOW: '#FFFF00', // ë…¸ë‘
                RED: '#FF0033' // ë¹¨ê°•
            };

            // --- í”Œë ˆì´ì–´ ---
            let player = {
                x: VIEWPORT_WIDTH / 4,
                y: VIEWPORT_HEIGHT / 2,
                dy: 0, // ìˆ˜ì§ ì†ë„
                color: 'BLUE', // 'BLUE' or 'YELLOW'
                isLifting: false
            };
            
            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
            
            // ë°ìŠ¤í¬í†± ì¡°ì‘
            document.addEventListener('keydown', e => {
                if (e.code === 'Space') {
                    player.isLifting = true;
                }
            });
            document.addEventListener('keyup', e => {
                if (e.code === 'Space') {
                    player.isLifting = false;
                }
            });
            canvas.addEventListener('click', togglePlayerColor); // PC í´ë¦­

            // ëª¨ë°”ì¼ ì¡°ì‘
            canvas.addEventListener('touchstart', e => {
                e.preventDefault();
                for (let i = 0; i < e.changedTouches.length; i++) {
                    const touch = e.changedTouches[i];
                    if (touch.clientX < VIEWPORT_WIDTH / 2) {
                        player.isLifting = true; // ì™¼ìª½ í™€ë“œ = ìƒìŠ¹
                    } else {
                        togglePlayerColor(); // ì˜¤ë¥¸ìª½ íƒ­ = ìƒ‰ìƒ ë³€ê²½
                    }
                }
            }, { passive: false });
            
            canvas.addEventListener('touchend', e => {
                e.preventDefault();
                // ë¦¬í”„íŒ… í„°ì¹˜ì¸ì§€ í™•ì¸ (ëª¨ë“  ë¦¬í”„íŒ… í„°ì¹˜ê°€ ëë‚¬ì„ ë•Œë§Œ í•˜ê°•)
                let stillLifting = false;
                for (let i = 0; i < e.touches.length; i++) {
                    if (e.touches[i].clientX < VIEWPORT_WIDTH / 2) {
                        stillLifting = true;
                        break;
                    }
                }
                if (!stillLifting) {
                    player.isLifting = false;
                }
            }, { passive: false });


            startButton.addEventListener('click', startGame);

            // --- í•µì‹¬ í•¨ìˆ˜ ---

            function startGame() {
                // ê²Œì„ ë³€ìˆ˜ ì´ˆê¸°í™”
                score = 0;
                frameCount = 0;
                SCROLL_SPEED = 3;
                gameState = 'playing';
                player.y = VIEWPORT_HEIGHT / 2;
                player.dy = 0;
                player.color = 'BLUE';
                obstacles = [];

                gameOverlay.classList.add('hidden');
                
                // ë©”ì¸ ë£¨í”„ ì‹œì‘
                gameLoop();
            }

            function endGame() {
                gameState = 'over';
                cancelAnimationFrame(gameLoopId);
                
                finalScoreDisplay.textContent = `ìµœì¢… ì ìˆ˜: ${score}`;
                startButton.textContent = 'ë‹¤ì‹œí•˜ê¸°';
                gameOverlay.classList.remove('hidden');
            }
            
            function togglePlayerColor() {
                if (gameState !== 'playing') return;
                player.color = (player.color === 'BLUE') ? 'YELLOW' : 'BLUE';
            }

            function gameLoop() {
                if (gameState !== 'playing') return;

                update();
                draw();

                gameLoopId = requestAnimationFrame(gameLoop);
            }

            // --- ì—…ë°ì´íŠ¸ ë¡œì§ ---
            function update() {
                frameCount++;
                
                // 1. í”Œë ˆì´ì–´ ì—…ë°ì´íŠ¸ (Ship ìŠ¤íƒ€ì¼)
                updatePlayer();
                
                // 2. ì¥ì• ë¬¼ ì—…ë°ì´íŠ¸
                updateObstacles();
                
                // 3. ì¶©ëŒ ì²´í¬
                checkCollisions();
                
                // 4. ì ìˆ˜ ë° ë‚œì´ë„
                score++;
                if (frameCount % 1000 === 0) { // ì•½ 16ì´ˆë§ˆë‹¤
                    SCROLL_SPEED += 0.5;
                }
            }

            function updatePlayer() {
                // ì¤‘ë ¥ ì ìš©
                player.dy += GRAVITY;
                
                // ìƒìŠ¹
                if (player.isLifting) {
                    player.dy += LIFT_FORCE;
                }
                
                // ì†ë„ ì œí•œ
                player.dy = Math.max(-5, Math.min(5, player.dy));
                
                // ìœ„ì¹˜ ì ìš©
                player.y += player.dy;

                // í™”ë©´ ë°–(ì²œì¥, ë°”ë‹¥) ì¶©ëŒ
                if (player.y < PLAYER_SIZE) {
                    player.y = PLAYER_SIZE;
                    player.dy = 0;
                }
                if (player.y > VIEWPORT_HEIGHT - PLAYER_SIZE) {
                    player.y = VIEWPORT_HEIGHT - PLAYER_SIZE;
                    player.dy = 0;
                }
            }
            
            function updateObstacles() {
                // ì¥ì• ë¬¼ ìƒì„±
                if (frameCount % 90 === 0) { // 1.5ì´ˆë§ˆë‹¤ (60fps ê¸°ì¤€)
                    const typeRoll = Math.random();
                    if (typeRoll < 0.3) {
                        // 30% í™•ë¥ ë¡œ ë¶‰ì€ ìŠ¤íŒŒì´í¬
                        const height = Math.random() * 80 + 20; // 20~100 ë†’ì´
                        const y = (Math.random() < 0.5) ? 0 : VIEWPORT_HEIGHT - height; // ìœ„ ë˜ëŠ” ì•„ë˜
                        obstacles.push({
                            type: 'SPIKE',
                            color: COLORS.RED,
                            x: VIEWPORT_WIDTH,
                            y: y,
                            width: 20,
                            height: height
                        });
                    } else {
                        // 70% í™•ë¥ ë¡œ ìƒ‰ìƒ ë²½
                        const wallColor = (Math.random() < 0.5) ? 'BLUE' : 'YELLOW';
                        const gapHeight = 150; // í†µê³¼ í‹ˆìƒˆ
                        const gapY = Math.random() * (VIEWPORT_HEIGHT - gapHeight - 100) + 50; // í‹ˆìƒˆ Yìœ„ì¹˜
                        
                        // ìƒë‹¨ ë²½
                        obstacles.push({
                            type: 'WALL',
                            color: (wallColor === 'BLUE') ? COLORS.BLUE : COLORS.YELLOW,
                            x: VIEWPORT_WIDTH,
                            y: 0,
                            width: 30,
                            height: gapY
                        });
                        // í•˜ë‹¨ ë²½
                        obstacles.push({
                            type: 'WALL',
                            color: (wallColor === 'BLUE') ? COLORS.BLUE : COLORS.YELLOW,
                            x: VIEWPORT_WIDTH,
                            y: gapY + gapHeight,
                            width: 30,
                            height: VIEWPORT_HEIGHT - gapY - gapHeight
                        });
                    }
                }
                
                // ì¥ì• ë¬¼ ì´ë™ ë° ì œê±°
                for (let i = obstacles.length - 1; i >= 0; i--) {
                    obstacles[i].x -= SCROLL_SPEED;
                    if (obstacles[i].x + obstacles[i].width < 0) {
                        obstacles.splice(i, 1);
                    }
                }
            }

            function checkCollisions() {
                const p = {
                    x: player.x - PLAYER_SIZE / 2,
                    y: player.y - PLAYER_SIZE / 2,
                    width: PLAYER_SIZE,
                    height: PLAYER_SIZE
                };

                for (const obs of obstacles) {
                    // AABB (Axis-Aligned Bounding Box) ì¶©ëŒ ê²€ì‚¬
                    if (p.x < obs.x + obs.width &&
                        p.x + p.width > obs.x &&
                        p.y < obs.y + obs.height &&
                        p.y + p.height > obs.y)
                    {
                        // ì¶©ëŒ ë°œìƒ
                        if (obs.type === 'SPIKE') {
                            endGame();
                            return;
                        }
                        
                        if (obs.type === 'WALL') {
                            if ( (obs.color === COLORS.BLUE && player.color !== 'BLUE') ||
                                 (obs.color === COLORS.YELLOW && player.color !== 'YELLOW') )
                            {
                                endGame();
                                return;
                            }
                        }
                    }
                }
            }


            // --- ê·¸ë¦¬ê¸° ë¡œì§ ---
            function draw() {
                // 1. ë°°ê²½ í´ë¦¬ì–´
                ctx.fillStyle = "#000";
                ctx.fillRect(0, 0, VIEWPORT_WIDTH, VIEWPORT_HEIGHT);

                // 2. ì¥ì• ë¬¼ ê·¸ë¦¬ê¸°
                obstacles.forEach(obs => {
                    ctx.fillStyle = obs.color;
                    
                    // ë„¤ì˜¨ íš¨ê³¼
                    ctx.shadowColor = obs.color;
                    ctx.shadowBlur = 15;
                    
                    if (obs.type === 'SPIKE') {
                        // ì‚¼ê°í˜• (ìŠ¤íŒŒì´í¬)
                        ctx.beginPath();
                        if (obs.y === 0) { // ì²œì¥ ìŠ¤íŒŒì´í¬
                            ctx.moveTo(obs.x, 0);
                            ctx.lineTo(obs.x + obs.width, 0);
                            ctx.lineTo(obs.x + obs.width / 2, obs.height);
                        } else { // ë°”ë‹¥ ìŠ¤íŒŒì´í¬
                            ctx.moveTo(obs.x, VIEWPORT_HEIGHT);
                            ctx.lineTo(obs.x + obs.width, VIEWPORT_HEIGHT);
                            ctx.lineTo(obs.x + obs.width / 2, obs.y);
                        }
                        ctx.closePath();
                        ctx.fill();
                    } else {
                        // ì‚¬ê°í˜• (ë²½)
                        ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
                    }
                });

                // 3. í”Œë ˆì´ì–´ ê·¸ë¦¬ê¸° (ë‹¤ì´ì•„ëª¬ë“œ ğŸ’ )
                ctx.fillStyle = (player.color === 'BLUE') ? COLORS.BLUE : COLORS.YELLOW;
                ctx.shadowColor = (player.color === 'BLUE') ? COLORS.BLUE : COLORS.YELLOW;
                ctx.shadowBlur = 20;
                
                ctx.save();
                ctx.translate(player.x, player.y);
                ctx.rotate(Math.PI / 4); // 45ë„ íšŒì „
                ctx.fillRect(-PLAYER_SIZE / 2, -PLAYER_SIZE / 2, PLAYER_SIZE, PLAYER_SIZE);
                ctx.restore();
                
                // ë„¤ì˜¨ íš¨ê³¼ ë¦¬ì…‹
                ctx.shadowBlur = 0;

                // 4. UI (ì ìˆ˜)
                ctx.fillStyle = "white";
                ctx.font = "24px Arial";
                ctx.textAlign = "left";
                ctx.fillText(`Score: ${score}`, 20, 40);
            }
        });
    </script>

</body>
</html>
